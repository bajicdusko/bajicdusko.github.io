<!DOCTYPE html><html lang="en" > <!-- The Head v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><head><meta http-equiv="refresh" content="0; url=https://www.crispy-engineering.com/kotlin-dsl-for-espresso-and-uiautomator/" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Kotlin DSL for Espresso and UIAutomator | Duško Bajić - Blog</title><meta name="generator" content="Jekyll v3.9.0" /><meta property="og:title" content="Kotlin DSL for Espresso and UIAutomator" /><meta name="author" content="Duško Bajić" /><meta property="og:locale" content="en_US" /><meta name="description" content="Android automation tests assume Espresso and UIAutomator. This DSL unifies them into unique syntax." /><meta property="og:description" content="Android automation tests assume Espresso and UIAutomator. This DSL unifies them into unique syntax." /><link rel="canonical" href="https://dusko.dev/posts/2018/11/kotlin-dsl-android-automated-tests/" /><meta property="og:url" content="https://dusko.dev/posts/2018/11/kotlin-dsl-android-automated-tests/" /><meta property="og:site_name" content="Duško Bajić - Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2018-11-06T13:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Kotlin DSL for Espresso and UIAutomator" /><meta name="twitter:site" content="@bajicdusko" /><meta name="twitter:creator" content="@bajicdusko" /><meta name="google-site-verification" content="1mycoeDFQZxslULZ44j-kZFIW_Qtl9b08z-8yg7W_gw" /> <script type="application/ld+json"> {"headline":"Kotlin DSL for Espresso and UIAutomator","dateModified":"2018-11-06T13:00:00+01:00","datePublished":"2018-11-06T13:00:00+01:00","url":"https://dusko.dev/posts/2018/11/kotlin-dsl-android-automated-tests/","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://dusko.dev/assets/img/profile.jpg"},"name":"Duško Bajić"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://dusko.dev/posts/2018/11/kotlin-dsl-android-automated-tests/"},"author":{"@type":"Person","name":"Duško Bajić"},"description":"Android automation tests assume Espresso and UIAutomator. This DSL unifies them into unique syntax.","@type":"BlogPosting","@context":"https://schema.org"}</script> <!-- The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps Generated by: https://www.favicon-generator.org/ v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT license --><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"> <!-- CSS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT Licensed --><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="script" href="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"> <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" async></script> <!-- JS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT Licensed --> <script src="/assets/js/post.min.js" async></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"> <!-- The Side Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/assets/img/profile.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">Duško Bajić - Blog</a></div><div class="site-subtitle font-italic">Android ● .NET ● AWS ● Photography</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-3 mr-3 unloaded"></i> <span>HOME</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-3 mr-3 unloaded"></i> <span>CATEGORIES</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-3 mr-3 unloaded"></i> <span>TAGS</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-3 mr-3 unloaded"></i> <span>ARCHIVES</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-3 mr-3 unloaded"></i> <span>ABOUT</span> </a></li></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <span id="mode-toggle-wrapper"> <!-- Switch the mode between dark and light. v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <i class="mode-toggle fas fa-sun" dark-mode-invisible></i> <i class="mode-toggle fas fa-moon" light-mode-invisible></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.mode != null) { if (this.mode == ModeToggle.DARK_MODE) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.mode != null) { if (self.mode == ModeToggle.DARK_MODE) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightkMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightkMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span> <span class="icon-border"></span> <a href="https://www.linkedin.com/in/bajicdusko" target="_blank"> <i class="fab fa-linkedin"></i> </a> <a href="https://github.com/bajicdusko" target="_blank"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/bajicdusko" target="_blank"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:window.open('mailto:' + ['bajicdusko','gmail.com'].join('@'))" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" > <i class="fas fa-rss"></i> </a></div></div><!-- The Top Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Kotlin DSL for Espresso and UIAutomator</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"> <!-- Fixed kramdown code highlight rendering: https://github.com/penibelst/jekyll-compress-html/issues/101 https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901 --><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Kotlin DSL for Espresso and UIAutomator</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <span class="timeago" data-toggle="tooltip" data-placement="bottom" title="Tue, Nov 6, 2018, 1:00 PM +0100"> Nov 6, 2018 <i class="unloaded">2018-11-06T13:00:00+01:00</i> </span> by <span class="author"> Duško Bajić </span></div></div><div class="post-content"><p>On Android there aren’t many choices when it comes to which library to use. Obvious choices are <a href="https://developer.android.com/training/testing/espresso/">Espresso</a> and <a href="https://developer.android.com/training/testing/ui-automator">UIAutomator</a>. Although the libraries can be used for the same goal, there are crucial differences between them. Shortly:</p><ul><li>Espresso is a white box solution for Android testing, sandboxed for the usage of testing the current application.</li><li>UIAutomator is a black box testing solution, which is running on the device level, giving us the capabilities of navigating outside of the currently tested application.</li></ul><p>For the purpose of end-to-end testing, we needed both libraries in order to pull out the best of both worlds and to implement proper automated testing of the app.</p><p>When the UI testing is implemented, the library syntax is never simple nor pretty. Having two libraries working together, with completely different syntax, makes readability and maintainability quite hard to achieve.</p><p>For example, let’s see how could we execute a click action on the UI component.</p><h2 id="espresso">Espresso</h2><p>In case of Espresso, we’re working with three types of objects. Matchers, ViewActions and ViewAssertions. Following the syntax and combining these three objects, we would implement click action like this:</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nc">Espresso</span><span class="o">.</span><span class="na">onView</span><span class="o">(</span><span class="nc">Matchers</span><span class="o">.</span><span class="na">withId</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">activityLoginBtnSubmit</span><span class="o">)).</span><span class="na">perform</span><span class="o">(</span><span class="nc">ViewActions</span><span class="o">.</span><span class="na">click</span><span class="o">())</span>
</pre></table></code></div></div><h2 id="uiautomator">UIAutomator</h2><p>In case of UIAutomator, it’s much more complicated. There are a couple of preconditions to make in order to query the UI hierarchy for the specific object.</p><ol><li>Getting the Context from the InstrumentationRegistry</li><li>Converting the resource ID into the resource name (we’ll need this later)</li><li>Creating the UIDevice object, which is a God object for the UIAutomator. Almost each call requires UIDevice instance.</li><li>Defining the UISelector. In our case, we want to create a UISelector to query the UI component by resource ID, but such a method doesn’t exist in UIAutomator. There is something similar (via resource name), so we’ll use it (that’s why 2).</li><li>Instantiating the UIObject by using the UIDevice and UISelector. Having the UIObject gives us the possibility to interact with the UIComponent.</li></ol><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="n">val</span> <span class="n">instrumentation</span> <span class="o">=</span> <span class="nc">InstrumentationRegistry</span><span class="o">.</span><span class="na">getInstrumentation</span><span class="o">()</span>
<span class="n">val</span> <span class="n">uiDevice</span> <span class="o">=</span> <span class="nc">UiDevice</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">instrumentation</span><span class="o">)</span>
<span class="n">val</span> <span class="n">appContext</span> <span class="o">=</span> <span class="nc">InstrumentationRegistry</span><span class="o">.</span><span class="na">getInstrumentation</span><span class="o">().</span><span class="na">targetContext</span>

<span class="n">val</span> <span class="n">loginButtonSelector</span> <span class="o">=</span> <span class="nc">UiSelector</span><span class="o">().</span><span class="na">resourceId</span><span class="o">(</span><span class="n">appContext</span><span class="o">.</span><span class="na">resources</span><span class="o">.</span><span class="na">getResourceName</span><span class="o">(</span>
        <span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">activityLoginBtnSubmit</span>
    <span class="o">)</span>
<span class="o">)</span>

<span class="n">val</span> <span class="n">loginButton</span> <span class="o">=</span> <span class="n">uiDevice</span><span class="o">.</span><span class="na">findObject</span><span class="o">(</span><span class="n">loginButtonSelector</span><span class="o">)</span>
<span class="n">loginButton</span><span class="o">.</span><span class="na">click</span><span class="o">()</span>
</pre></table></code></div></div><p>Now imagine combining these two and making 10-15 navigations through the app in order to check some view located deep in the hierarchy… Yes, maintainability is equal to <strong>zero</strong>. Readability is equal to <strong>headache</strong>.</p><h2 id="the-dsl-idea">The DSL idea</h2><p>We’ve recognised this problem right in the beginning and decided to use the power of Kotlin to write a DSL which unifies the syntax for both libraries. An additional benefit we get is an easier handover of the codebase to the new colleague, as the DSL syntax is more logical and simpler to grasp.</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">click</span> <span class="n">on</span> <span class="nf">button</span><span class="p">(</span><span class="nc">R</span><span class="p">.</span><span class="n">id</span><span class="p">.</span><span class="n">activityLoginBtnLogin</span><span class="p">)</span>
</pre></table></code></div></div><p>Just by looking into the existing examples, writing the new tests shouldn’t be a hurdle at all. We proved this by introducing the new colleague into the team, inexperienced in Kotlin, and he started writing production ready tests in a matter of week. Yay!<br /> Extending the DSL proved to be a simple as well.<br /> The syntax we come up with should be human readable as much as possible and hopefully we succeeded. It’s identical for both, Espresso and UIAutomator. It just depends of what function you imported on first use in the class.</p><h3 id="the-library">The library</h3><p>During development, we’ve had to use more and more actions and assertions on the UI components, so the DSL grew over time. At one point it became problematic to maintain that collection of functions as well, so we had to organise it and make it independent of the current application we were testing. The library is born.</p><p><a href="https://github.com/codecentric/androidtestktx">Android Test KTX</a> is a resulting library which is deployed to the GitHub and open sourced under Apache 2.0 license for the public use.</p><h3 id="internal-organisation">Internal organisation</h3><p>As everything goes in pairs now, so does the library organisation:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://dusko.dev/assets/img/posts/2018/2018-11-06-kotlin-dsl-library-structure.png" alt="Kotlin DSL library organisation" width="190px" /></p><p>Functions are split into two main packages called espresso and uiautomator. Further, each package has an <em>Actions.kt</em>, <em>Assertions.kt, Matchers.kt</em> and {library}<em>Extensions.kt</em>.</p><p>The Actions file contains functions which execute some action on the UI component. <em>click</em>, <em>typeText</em>, <em>scroll</em>.<br /> Matchers file, contains functions for finding the UI component on the screen. <em>viewById</em>, <em>viewByText</em>.<br /> The Assertions file contains functions for checking the state of the UI component. itIsDisplayed, itIsEnabled.</p><h3 id="infix-notation">infix notation</h3><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">click</span> <span class="n">on</span> <span class="nf">button</span><span class="p">(</span><span class="nc">R</span><span class="p">.</span><span class="n">id</span><span class="p">.</span><span class="n">activityLoginBtnSubmit</span><span class="p">)</span>
</pre></table></code></div></div><p>or</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nf">typeText</span><span class="p">(</span><span class="s">"dummyUsername"</span><span class="p">)</span> <span class="n">into</span> <span class="nf">text</span><span class="p">(</span><span class="nc">R</span><span class="p">.</span><span class="n">id</span><span class="p">.</span><span class="n">activityLoginEtUsername</span><span class="p">)</span>
</pre></table></code></div></div><p>are both written in the infix notation, where the <code class="language-plaintext highlighter-rouge">on</code> and <code class="language-plaintext highlighter-rouge">into</code> are infix extension functions.</p><p>These expressions could be written like this as well:</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nf">viewById</span><span class="p">(</span><span class="nc">R</span><span class="p">.</span><span class="n">id</span><span class="p">.</span><span class="n">activityLoginBtnSubmit</span><span class="p">).</span><span class="nf">click</span><span class="p">()</span>
</pre></table></code></div></div><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nf">viewById</span><span class="p">(</span><span class="nc">R</span><span class="p">.</span><span class="n">id</span><span class="p">.</span><span class="n">activityLoginEtUsername</span><span class="p">).</span><span class="nf">typeText</span><span class="p">(</span><span class="s">"dummyUsername"</span><span class="p">)</span>
</pre></table></code></div></div><p>We’ve left it to be a personal choice of the library user.</p><p><code class="language-plaintext highlighter-rouge">on</code> and into functions have an identical implementation, and we created <code class="language-plaintext highlighter-rouge">onto</code> function as well. Their purpose is to increase the readability and semantical meaning of the expression.<br /> We want to click <code class="language-plaintext highlighter-rouge">on</code> something, type <code class="language-plaintext highlighter-rouge">into</code> some field or hold <code class="language-plaintext highlighter-rouge">onto</code> something else.</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">infix</span> <span class="k">fun</span> <span class="nc">ViewAction</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="n">matcher</span><span class="p">:</span> <span class="nc">Matcher</span><span class="p">)</span> <span class="p">{</span>
  <span class="nc">Espresso</span><span class="p">.</span><span class="nf">onView</span><span class="p">(</span><span class="n">matcher</span><span class="p">).</span><span class="nf">perform</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">view</code>, <code class="language-plaintext highlighter-rouge">text</code>, <code class="language-plaintext highlighter-rouge">field</code> and <code class="language-plaintext highlighter-rouge">button</code> are also the functions with the identical implementation, doing the same thing as <code class="language-plaintext highlighter-rouge">viewById</code> it should improve the semantical meaning of the expression.</p><p>This DSL proved to be a working solution, which simplifies and accelerates the testing process. Personal satisfaction shouldn’t be excluded either, as writing the concise and readable code make you feel better. Me at least. Time spent on debugging and understanding the test is brought down to minimum. What’s more important, if you’re using this library, knowing full UIAutomator or Espresso logic isn’t necessary any more, or at least it shouldn’t be mandatory.</p><h3 id="verification">Verification</h3><p>Finding the UI component and making an interaction with it brings us a half way to the goal. With the verification of the UI component state, we’re completing the test. We’ve introduced the <code class="language-plaintext highlighter-rouge">verifyThat</code> infix extension function to cover the readability of the Assertion part.</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">infix</span> <span class="k">fun</span> <span class="nc">Matcher</span><span class="p">.</span><span class="nf">verifyThat</span><span class="p">(</span><span class="n">func</span><span class="p">:</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="nc">ViewAssertion</span><span class="p">)</span> <span class="p">{</span>
  <span class="nf">onView</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nf">check</span><span class="p">(</span><span class="nf">func</span><span class="p">())</span>
<span class="p">}</span>
</pre></table></code></div></div><p>This function influenced the naming of the assertion functions greatly, as we constantly have a semantical meaning of the expression in mind.</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="kd">val</span> <span class="py">usernameField</span> <span class="p">=</span> <span class="nf">viewById</span><span class="p">(</span><span class="nc">R</span><span class="p">.</span><span class="n">id</span><span class="p">.</span><span class="n">activityLoginEtUsername</span><span class="p">)</span>
<span class="nf">typeText</span><span class="p">(</span><span class="s">"dummyUsername"</span><span class="p">)</span> <span class="n">into</span> <span class="n">usernameField</span>
<span class="n">click</span> <span class="n">on</span> <span class="nf">button</span><span class="p">(</span><span class="nc">R</span><span class="p">.</span><span class="n">id</span><span class="p">.</span><span class="n">activityLoginBtnSubmit</span><span class="p">)</span>

<span class="n">usernameField</span> <span class="nf">verifyThat</span> <span class="p">{</span> <span class="nf">itIsNotEnabled</span><span class="p">()</span> <span class="p">}</span>
</pre></table></code></div></div><h3 id="usage">Usage</h3><p>This library is deployed onto the JCenter and can be added into the project by adding the line below into the <code class="language-plaintext highlighter-rouge">build.gradle</code> file.</p><div class="language-gradle highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">androidTestImplementation</span> <span class="s1">'de.codecentric:androidtestktx:$latestVersion'</span>
</pre></table></code></div></div><h3 id="friendly-advice">Friendly advice</h3><ul><li>Although the UIAutomator worked quite well for us, it was the cause of most headaches as well. Espresso proved to be a better solution. So the future library development will follow the Espresso cheat sheet and implement the same actions for the UIAutomator. Library version 1.0.0 should bring separate artefacts for Espresso and UIAutomator.</li><li>Using the DSL in combination with the Robot pattern is strongly encouraged. The power of the Robot pattern combined with Kotlin is described in a separated blog post, <a href="https://dusko.dev/posts/2018/11/android-automated-tests-with-robot-pattern">Automated tests in Android with Robot pattern</a>. Here is a sneak peek:</li></ul><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="nd">@Test</span>
<span class="k">fun</span> <span class="nf">shouldLoginTest</span><span class="p">()</span> <span class="p">{</span>
  <span class="nf">withLoginRobot</span> <span class="p">{</span>
    <span class="nf">initiateTheLogin</span><span class="p">()</span>
  <span class="p">}</span> <span class="nf">andThen</span> <span class="p">{</span>
    <span class="nf">acceptThePermissions</span><span class="p">()</span>
  <span class="p">}</span> <span class="nf">andThenVerifyThat</span> <span class="p">{</span>
    <span class="nf">userIsLoggedIn</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/android/'>android</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/android/" class="post-tag no-text-decoration" >android</a> <a href="/tags/test/" class="post-tag no-text-decoration" >test</a> <a href="/tags/kotlin/" class="post-tag no-text-decoration" >kotlin</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><!-- Post sharing snippet v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Kotlin DSL for Espresso and UIAutomator - Duško Bajić - Blog&url=https://dusko.dev/posts/2018/11/kotlin-dsl-android-automated-tests/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://dusko.dev/posts/2018/11/kotlin-dsl-android-automated-tests/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank"> <i class="fa-fw fab fa-linkedin"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Kotlin DSL for Espresso and UIAutomator - Duško Bajić - Blog&u=https://dusko.dev/posts/2018/11/kotlin-dsl-android-automated-tests/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Kotlin DSL for Espresso and UIAutomator - Duško Bajić - Blog&url=https://dusko.dev/posts/2018/11/kotlin-dsl-android-automated-tests/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><!-- The Pannel on right side (Desktop views) v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><h3 data-toc-skip>Recent Update</h3><ul class="post-content pl-0 pb-1 ml-1 mt-2"></ul></div><div id="access-tags"><h3 data-toc-skip>Trending Tags</h3><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/privacy/">privacy</a> <a class="post-tag" href="/tags/cloud/">cloud</a> <a class="post-tag" href="/tags/test/">test</a> <a class="post-tag" href="/tags/nextcloud/">nextcloud</a> <a class="post-tag" href="/tags/google/">google</a> <a class="post-tag" href="/tags/kotlin/">kotlin</a> <a class="post-tag" href="/tags/freelance/">freelance</a> <a class="post-tag" href="/tags/work/">work</a> <a class="post-tag" href="/tags/view/">view</a></div></div></div></div></div><div class="row"><div id="post-extend-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <!-- Navigation buttons at the bottom of the post. v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --><div class="post-navigation d-flex justify-content-between"> <a href="/posts/2018/09/android-testing-aws-device-farm-vs-firebase-test-lab/" class="btn btn-outline-primary"><p>Android testing: AWS Device Farm vs Firebase TestLab</p></a> <a href="/posts/2018/11/android-automated-tests-with-robot-pattern/" class="btn btn-outline-primary"><p>Android automated tests with Robot pattern (in Kotlin)</p></a></div><!-- The Disqus lazy loading. Powered by: https://osvaldas.info/lazy-loading-disqus-comments v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung MIT License --><div id="disqus" class="pt-2 pb-4"><p class="font-italic text-muted small">Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> var options = { scriptUrl: '//duskodev.disqus.com/embed.js', disqusConfig: function() { this.page.url = 'https://dusko.dev/posts/2018/11/kotlin-dsl-android-automated-tests/'; this.page.identifier = '/posts/2018/11/kotlin-dsl-android-automated-tests/'; } }; $.disqusLoader('#disqus', options); </script> <!-- The related posts of current post. Placed in the bottom of every single post. v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div id="related-posts" class="mt-4 mb-2 mb-sm-4 pb-2"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/2018/11/android-automated-tests-with-robot-pattern/"><div class="card-body"> <span class="timeago small"> Nov 7, 2018 <i class="unloaded">2018-11-07T13:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Android automated tests with Robot pattern (in Kotlin)</h3><div class="text-muted small"><p>In previous blog post, we have discussed and shown a Kotlin DSL library we developed for the Espresso and UIAutomator, as we noticed that readability and maintainability are endangered and made a n...</p></div></div></a></div><div class="card"> <a href="/posts/2018/09/android-testing-aws-device-farm-vs-firebase-test-lab/"><div class="card-body"> <span class="timeago small"> Sep 27, 2018 <i class="unloaded">2018-09-27T13:00:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Android testing: AWS Device Farm vs Firebase TestLab</h3><div class="text-muted small"><p>A whole year passed since I started working on Android automation testing solution on the project for a large corporation. The project is handed over to another team now, and it’s time to share the...</p></div></div></a></div><div class="card"> <a href="/posts/2017/06/simplified-fragment-management/"><div class="card-body"> <span class="timeago small"> Jun 8, 2017 <i class="unloaded">2017-06-08T10:03:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Simplified Fragment Management</h3><div class="text-muted small"><p>Handling fragments(lifecycle) in android app was complicated from the beginning. Nowadays, a lot of internal bugs is fixed, but still there is a general negativity towards fragment usage. Many dev...</p></div></div></a></div></div></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script> <!-- The Footer v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/bajicdusko">Duško Bajić</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Content rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/">Chirpy</a> theme.</p></div></div></footer></div><!-- The Search results v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/privacy/">privacy</a> <a class="post-tag" href="/tags/cloud/">cloud</a> <a class="post-tag" href="/tags/test/">test</a> <a class="post-tag" href="/tags/nextcloud/">nextcloud</a> <a class="post-tag" href="/tags/google/">google</a> <a class="post-tag" href="/tags/kotlin/">kotlin</a> <a class="post-tag" href="/tags/freelance/">freelance</a> <a class="post-tag" href="/tags/work/">work</a> <a class="post-tag" href="/tags/view/">view</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <!-- Jekyll Simple Search loader v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://dusko.dev{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
