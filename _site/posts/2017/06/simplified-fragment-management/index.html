<!DOCTYPE html><html lang="en" > <!-- The Head v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Simplified Fragment Management | Duško Bajić - Blog</title><meta name="generator" content="Jekyll v3.9.0" /><meta property="og:title" content="Simplified Fragment Management" /><meta name="author" content="Duško Bajić" /><meta property="og:locale" content="en_US" /><meta name="description" content="SimpleFragmentManager is basically a wrapper around FragmentManager and exposes ‘add’, ‘replace’, ‘popUp’, ‘onBackPressed’ and ‘getCurrentFragment’ methods. SimpleFragmentManager assumes that…" /><meta property="og:description" content="SimpleFragmentManager is basically a wrapper around FragmentManager and exposes ‘add’, ‘replace’, ‘popUp’, ‘onBackPressed’ and ‘getCurrentFragment’ methods. SimpleFragmentManager assumes that…" /><link rel="canonical" href="https://dusko.dev/posts/2017/06/simplified-fragment-management/" /><meta property="og:url" content="https://dusko.dev/posts/2017/06/simplified-fragment-management/" /><meta property="og:site_name" content="Duško Bajić - Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2017-06-08T10:03:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Simplified Fragment Management" /><meta name="twitter:site" content="@bajicdusko" /><meta name="twitter:creator" content="@bajicdusko" /><meta name="google-site-verification" content="1mycoeDFQZxslULZ44j-kZFIW_Qtl9b08z-8yg7W_gw" /> <script type="application/ld+json"> {"headline":"Simplified Fragment Management","dateModified":"2017-06-08T10:03:00+02:00","datePublished":"2017-06-08T10:03:00+02:00","url":"https://dusko.dev/posts/2017/06/simplified-fragment-management/","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://dusko.dev/assets/img/profile.jpg"},"name":"Duško Bajić"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://dusko.dev/posts/2017/06/simplified-fragment-management/"},"author":{"@type":"Person","name":"Duško Bajić"},"description":"SimpleFragmentManager is basically a wrapper around FragmentManager and exposes ‘add’, ‘replace’, ‘popUp’, ‘onBackPressed’ and ‘getCurrentFragment’ methods. SimpleFragmentManager assumes that…","@type":"BlogPosting","@context":"https://schema.org"}</script> <!-- The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps Generated by: https://www.favicon-generator.org/ v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT license --><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"> <!-- CSS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT Licensed --><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="script" href="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"> <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" async></script> <!-- JS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT Licensed --> <script src="/assets/js/post.min.js" async></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"> <!-- The Side Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/assets/img/profile.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">Duško Bajić - Blog</a></div><div class="site-subtitle font-italic">Android ● .NET ● AWS ● Photography</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-3 mr-3 unloaded"></i> <span>HOME</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-3 mr-3 unloaded"></i> <span>CATEGORIES</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-3 mr-3 unloaded"></i> <span>TAGS</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-3 mr-3 unloaded"></i> <span>ARCHIVES</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-3 mr-3 unloaded"></i> <span>ABOUT</span> </a></li></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <span id="mode-toggle-wrapper"> <!-- Switch the mode between dark and light. v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <i class="mode-toggle fas fa-sun" dark-mode-invisible></i> <i class="mode-toggle fas fa-moon" light-mode-invisible></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.mode != null) { if (this.mode == ModeToggle.DARK_MODE) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.mode != null) { if (self.mode == ModeToggle.DARK_MODE) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightkMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightkMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span> <span class="icon-border"></span> <a href="https://www.linkedin.com/in/bajicdusko" target="_blank"> <i class="fab fa-linkedin"></i> </a> <a href="https://github.com/bajicdusko" target="_blank"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/bajicdusko" target="_blank"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:window.open('mailto:' + ['bajicdusko','gmail.com'].join('@'))" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" > <i class="fas fa-rss"></i> </a></div></div><!-- The Top Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Simplified Fragment Management</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"> <!-- Fixed kramdown code highlight rendering: https://github.com/penibelst/jekyll-compress-html/issues/101 https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901 --><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Simplified Fragment Management</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <span class="timeago" data-toggle="tooltip" data-placement="bottom" title="Thu, Jun 8, 2017, 10:03 AM +0200"> Jun 8, 2017 <i class="unloaded">2017-06-08T10:03:00+02:00</i> </span> by <span class="author"> Duško Bajić </span></div><div> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Wed, Jun 3, 2020, 12:24 AM +0200"> Jun 3, 2020 <i class="unloaded">2020-06-03T00:24:59+02:00</i> </span></div></div><div class="post-content"><p>Handling fragments(lifecycle) in android app was complicated from the beginning. Nowadays, a lot of internal bugs is fixed, but still there is a general negativity towards fragment usage.</p><p>Many developers are avoiding fragments and returning to old fashion apps with the large number of the activities. Just because it’s “complicated”, it does not mean that we have to stop using it. Fragments are (at the moment) part of our apps and we have to deal with it the best we can.</p><p>These issues might feel a little bit basic, however, by working on many android apps, I’ve noticed few constant problem-patterns (listed-below) when it comes to fragments. If you’d just like to jump to implementation, <a href="#solution">click here</a>.</p><ol><li><p><strong>Getting instance of Fragment</strong> (for whatever reason) from the existing stack of transactions, regardless of the position in the stack.</p><p>One way of getting the last added fragment might be this one:</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="c1">//fetching all fragments</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Fragment</span><span class="o">&gt;</span> <span class="n">fragments</span> <span class="o">=</span> <span class="n">fragmentManager</span><span class="o">.</span><span class="na">getFragments</span><span class="o">();</span>

<span class="c1">//getting last added fragment</span>
<span class="nc">Fragment</span> <span class="n">currentFragment</span> <span class="o">=</span> <span class="n">fragments</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">fragments</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">-</span> <span class="mi">1</span><span class="o">);</span>
</pre></table></code></div></div><p>Although this approach makes sense, it is possible that some fragments are removed in the meantime and this list will contain <code class="language-plaintext highlighter-rouge">null</code> (instead of trimmed size).</p><p>If, for example, we have <code class="language-plaintext highlighter-rouge">three</code> fragments on stack and we just tapped back button, we might get <code class="language-plaintext highlighter-rouge">fragment.size() == 3</code> but actual number of fragments is <code class="language-plaintext highlighter-rouge">two</code> and third position <code class="language-plaintext highlighter-rouge">fragments.get(fragments.size() - 1)</code> will return <code class="language-plaintext highlighter-rouge">null</code>.</p><p>And I cannot point the obvious more than it is, but <strong>this is the stack</strong> and still it can happen with any other index in the list. Since we have a <code class="language-plaintext highlighter-rouge">List&lt;&gt;</code> interface exposed, then we can call <code class="language-plaintext highlighter-rouge">fragments.get(0)</code> and wow, it returns <code class="language-plaintext highlighter-rouge">null</code>, <code class="language-plaintext highlighter-rouge">fragments.size()</code> value will be incorrect and no matter what index we use, we won’t get correct fragment instance.</p><p>Then we might say, ok we can use this approach instead:</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="c1">//fetching all fragments</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Fragment</span><span class="o">&gt;</span> <span class="n">fragments</span> <span class="o">=</span> <span class="n">fragmentManager</span><span class="o">.</span><span class="na">getFragments</span><span class="o">();</span>

<span class="c1">//getting the actual number of fragments from the fragmentManager</span>
<span class="kt">int</span> <span class="n">fragmentsCount</span> <span class="o">=</span> <span class="n">fragmentManager</span><span class="o">.</span><span class="na">getBackStackEntryCount</span><span class="o">();</span>

<span class="c1">//getting last added fragment</span>
<span class="nc">Fragment</span> <span class="n">currentFragment</span> <span class="o">=</span> <span class="n">fragments</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">fragmentsCount</span> <span class="o">-</span> <span class="mi">1</span><span class="o">);</span>
</pre></table></code></div></div><p>And great, now we have the exact number of fragments on the stack, however, <code class="language-plaintext highlighter-rouge">fragments</code> list still can contain <code class="language-plaintext highlighter-rouge">null</code> values on any position and we’ll end up with wrong fragment or with <code class="language-plaintext highlighter-rouge">java.lang.IndexOutOfBoundsException</code> in the worst case. Additional work is needed anyway and it seams its a lot of work just to get instance of fragment we have created in the first place.</p></li><li><p><strong>Handling onBackPressed navigation and application title update</strong></p><p>Typical android application shows <code class="language-plaintext highlighter-rouge">Toolbar</code> on top of the screen. If the <code class="language-plaintext highlighter-rouge">Toolbar</code> is part of the <code class="language-plaintext highlighter-rouge">Activity</code> layout we need to update its <code class="language-plaintext highlighter-rouge">title</code> according to currently active fragment.</p><p>For example:</p><p><code class="language-plaintext highlighter-rouge">HomeActivity.java</code></p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="nd">@Inject</span> <span class="nc">FragmentManager</span> <span class="n">supportFragmentManager</span><span class="o">;</span>
<span class="nd">@BindView</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">toolbar</span><span class="o">)</span> <span class="nc">Toolbar</span> <span class="n">toolbar</span><span class="o">;</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nc">Bundle</span> <span class="n">savedInstanceState</span><span class="o">){</span>
  <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
  <span class="o">...</span>
  <span class="n">setSupportActionBar</span><span class="o">(</span><span class="n">toolbar</span><span class="o">);</span>
  <span class="n">supportFragmentManager</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">()</span>
             <span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">activity_home_fragment_container</span><span class="o">,</span> <span class="nc">HomeFragment</span><span class="o">.</span><span class="na">newInstance</span><span class="o">())</span>
             <span class="o">.</span><span class="na">addToBackStack</span><span class="o">(</span><span class="kc">null</span><span class="o">)</span>
             <span class="o">.</span><span class="na">commit</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTitle</span><span class="o">(</span><span class="nd">@StringRes</span> <span class="kt">int</span> <span class="n">titleId</span><span class="o">){</span>
  <span class="n">getSupportActionBar</span><span class="o">().</span><span class="na">setTitle</span><span class="o">(</span><span class="n">getString</span><span class="o">(</span><span class="n">titleId</span><span class="o">));</span>
<span class="o">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">HomeFragment.java</code></p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onStart</span><span class="o">()</span> <span class="o">{</span>
   <span class="kd">super</span><span class="o">.</span><span class="na">onStart</span><span class="o">();</span>
   <span class="o">((</span><span class="nc">HomeActivity</span><span class="o">)</span><span class="n">getActivity</span><span class="o">()).</span><span class="na">setTitle</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">home</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p>And this actually works. Except you might get <code class="language-plaintext highlighter-rouge">NullPointerException</code> sometimes or <code class="language-plaintext highlighter-rouge">java.lang.IllegalStateException: Fragment LoginFragment not attached to Activity</code> and honestly, I’ve stopped looking for reasons why. If you move <code class="language-plaintext highlighter-rouge">getActivity().setTitle(R.string.login);</code> to some other location in the fragment, <code class="language-plaintext highlighter-rouge">setTitle</code> might get called too late and we’re triggering bad user experience.</p><p>On the other hand, when you’re popping the fragment from the stack, you have to call <code class="language-plaintext highlighter-rouge">setTitle()</code> method of the <code class="language-plaintext highlighter-rouge">Fragment</code> which is popping up and at some point <code class="language-plaintext highlighter-rouge">setTitle()</code> method might not get called at all, and you end up with <code class="language-plaintext highlighter-rouge">title</code> in the <code class="language-plaintext highlighter-rouge">Toolbar</code> that does not match the content.</p><p>It does not have to be the title, you might want to change navigation options for different fragments, to show back arrow instead of hamburger icon etc, and setting these options will depend of some method call inside the <code class="language-plaintext highlighter-rouge">Fragment</code>.</p></li><li><p><strong>Reseting stack</strong> triggers lifecycle of each fragment along the way</p><p>At some point, we have to return to the starting point of the app. So we’ll be popping the fragments from the stack until stack gets empty or until there is only one fragment shown. Not so obvious problem that occurs is that each popped fragment gets re-instantiated with call to all lifecycle methods, and causing execution of logic we put in each fragment. This is definitely unwanted behavior. We just want to remove them so that we can start from the beginning.</p></li><li><p><strong>Communication</strong> between fragments and the hosting Activity should not be implemented by casting <code class="language-plaintext highlighter-rouge">getActivity()</code> method and I like to think that no one implements it like that. Instead, communication between activity and the fragments should be implemented via interface which <code class="language-plaintext highlighter-rouge">Activity</code> implements, I know, obvious.</p></li></ol><p><a name="solution">Simple solution</a> I came up with have four main components:</p><ul><li><p><code class="language-plaintext highlighter-rouge">SimpleFragmentManager</code> which is basically a wrapper around <code class="language-plaintext highlighter-rouge">FragmentManager</code> and exposes the methods for <code class="language-plaintext highlighter-rouge">add</code>, <code class="language-plaintext highlighter-rouge">replace</code>, <code class="language-plaintext highlighter-rouge">popUp</code>, <code class="language-plaintext highlighter-rouge">popUpAll</code> and <code class="language-plaintext highlighter-rouge">getCurrentFragment</code> operations. <code class="language-plaintext highlighter-rouge">SimpleFragmentManager</code> assumes that each <code class="language-plaintext highlighter-rouge">Fragment</code> implements <code class="language-plaintext highlighter-rouge">IFragment</code> interface.</p></li><li><p><code class="language-plaintext highlighter-rouge">IFragment</code> interface is forcing each <code class="language-plaintext highlighter-rouge">Fragment</code> to have its own unique <code class="language-plaintext highlighter-rouge">name</code> or <code class="language-plaintext highlighter-rouge">tag</code> under which is added to transaction, <code class="language-plaintext highlighter-rouge">dispose()</code> method (which is very handy when implementing <code class="language-plaintext highlighter-rouge">RxJava2</code>), and yes, method to <code class="language-plaintext highlighter-rouge">setTitle()</code> of the <code class="language-plaintext highlighter-rouge">Toolbar/ActionBar</code>.</p></li><li><p><code class="language-plaintext highlighter-rouge">FragmentTagStack</code> to handle stack easily and retrieve fragments. It does not contain fragment instances, but its <code class="language-plaintext highlighter-rouge">tags</code> as <code class="language-plaintext highlighter-rouge">String</code> values instead and have only basic methods for <code class="language-plaintext highlighter-rouge">pop</code>, <code class="language-plaintext highlighter-rouge">popUpAll</code>, <code class="language-plaintext highlighter-rouge">peek</code>, <code class="language-plaintext highlighter-rouge">push</code> and <code class="language-plaintext highlighter-rouge">getActiveTag</code> which returns tag of currently shown <code class="language-plaintext highlighter-rouge">Fragment</code> on the screen.</p></li><li><p><code class="language-plaintext highlighter-rouge">FragmentChannel</code> is the most basic interface for callback implementation between the <code class="language-plaintext highlighter-rouge">Fragment</code> and hosting environment, which can be <code class="language-plaintext highlighter-rouge">Activity</code> or parent <code class="language-plaintext highlighter-rouge">Fragment</code>.</p></li></ul><p>And here is the sequence diagram that simplifies the explanation, that shows basic interaction with adding, replacing and removing fragments.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://dusko.dev/assets/img/posts/2017/2017-06-08-fragmentdiagram.svg" alt="Sequence Diagram" /></p><p>It is obvious that implementation is really simple. To make things even more easier, sources can be easily found by referencing the library in your <code class="language-plaintext highlighter-rouge">build.gradle</code> file: <code class="language-plaintext highlighter-rouge">implementation 'com.bajicdusko:fragment-manager:1.0.2'</code>.</p><p>You have the freedom to reimplement base classes for the activities and fragments, or you can extend already prepared <code class="language-plaintext highlighter-rouge">SFMActivity</code> and <code class="language-plaintext highlighter-rouge">SFMFragment</code> class which do all the work for you.</p><p>In case that you’re unable to extend these classes, these are the preconditions you have to prepare in your own class.</p><ol><li>Activity initialize <code class="language-plaintext highlighter-rouge">SimpleFragmentManager</code>.<ul><li>Override <code class="language-plaintext highlighter-rouge">onSaveInstanceState</code> and <code class="language-plaintext highlighter-rouge">onRestoreInstanceState</code> methods and forward the state to <code class="language-plaintext highlighter-rouge">SimpleFragmentManager</code>.</li><li>Override <code class="language-plaintext highlighter-rouge">onBackPressed</code> method forward the call to <code class="language-plaintext highlighter-rouge">SimpleFragmentManager</code>.</li><li>Implement <code class="language-plaintext highlighter-rouge">FragmentChannel</code>.</li></ul></li><li>Each <code class="language-plaintext highlighter-rouge">Fragment</code> implements <code class="language-plaintext highlighter-rouge">IFragment</code> interface. <em>Tip: Usually, having <code class="language-plaintext highlighter-rouge">abstract BaseFragment</code> class which implements <code class="language-plaintext highlighter-rouge">IFragment</code> and initializes <code class="language-plaintext highlighter-rouge">FragmentChannel</code> is less error prone, then implementing these methods for all Fragments individually.</em></li></ol><p>Example implementation can be found in this <strong><a href="https://github.com/bajicdusko/SimpleFragmentManager">sample project</a></strong>. as well as implementations of described components below. Once you establish hierarchy as below, you won’t have to think about it much. Only component that you’ll update constantly is <code class="language-plaintext highlighter-rouge">FragmentChannel</code> interface since you’ll be implementing all <code class="language-plaintext highlighter-rouge">Fragment</code> -&gt; <code class="language-plaintext highlighter-rouge">Activity</code> calls through it. <code class="language-plaintext highlighter-rouge">showLogin()</code> function in example below is one such case.</p><p><code class="language-plaintext highlighter-rouge">SimpleFragmentManager.kt</code></p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">SimpleFragmentManager</span><span class="p">(</span><span class="k">private</span> <span class="kd">val</span> <span class="py">fragmentManager</span><span class="p">:</span> <span class="nc">FragmentManager</span><span class="p">,</span> <span class="k">private</span> <span class="kd">val</span> <span class="py">fragmentContainerId</span><span class="p">:</span> <span class="nc">Int</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">private</span> <span class="kd">val</span> <span class="py">KEY_TAGS</span> <span class="p">=</span> <span class="s">"key_tags"</span>
    <span class="k">private</span> <span class="kd">var</span> <span class="py">fragmentTagStack</span><span class="p">:</span> <span class="nc">FragmentTagStack</span> <span class="p">=</span> <span class="nc">FragmentTagStack</span><span class="p">()</span>

    <span class="k">constructor</span><span class="p">(</span><span class="n">fragmentManager</span><span class="p">:</span> <span class="nc">FragmentManager</span><span class="p">,</span> <span class="n">fragmentContainer</span><span class="p">:</span> <span class="nc">FrameLayout</span><span class="p">)</span> <span class="p">:</span> <span class="k">this</span><span class="p">(</span><span class="n">fragmentManager</span><span class="p">,</span> <span class="n">fragmentContainer</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>

    <span class="k">fun</span> <span class="nf">addFragment</span><span class="p">(</span><span class="n">fragment</span><span class="p">:</span> <span class="nc">IFragment</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">fragmentTagStack</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="n">fragment</span><span class="p">.</span><span class="nf">getFragmentName</span><span class="p">())</span>
        <span class="n">fragmentManager</span><span class="p">.</span><span class="nf">beginTransaction</span><span class="p">()</span>
                <span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">fragmentContainerId</span><span class="p">,</span> <span class="n">fragment</span> <span class="k">as</span> <span class="nc">Fragment</span><span class="p">,</span> <span class="n">fragment</span><span class="p">.</span><span class="nf">getFragmentName</span><span class="p">())</span>
                <span class="p">.</span><span class="nf">addToBackStack</span><span class="p">(</span><span class="n">fragment</span><span class="p">.</span><span class="nf">getFragmentName</span><span class="p">())</span>
                <span class="p">.</span><span class="nf">commit</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">replaceFragment</span><span class="p">(</span><span class="n">fragment</span><span class="p">:</span> <span class="nc">IFragment</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">fragmentTagStack</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="n">fragment</span><span class="p">.</span><span class="nf">getFragmentName</span><span class="p">())</span>
        <span class="n">fragmentManager</span><span class="p">.</span><span class="nf">beginTransaction</span><span class="p">()</span>
                <span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="n">fragmentContainerId</span><span class="p">,</span> <span class="n">fragment</span> <span class="k">as</span> <span class="nc">Fragment</span><span class="p">,</span> <span class="n">fragment</span><span class="p">.</span><span class="nf">getFragmentName</span><span class="p">())</span>
                <span class="p">.</span><span class="nf">addToBackStack</span><span class="p">(</span><span class="n">fragment</span><span class="p">.</span><span class="nf">getFragmentName</span><span class="p">())</span>
                <span class="p">.</span><span class="nf">commit</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="cm">/**
     * When [Activity.onBackPressed] is called it is a good practice to override it and to call this method.
     * This method won't allow removal of last fragment on the stack.
     *
     * @return TRUE if fragment is poppedUp aka method is consumed, or FALSE if there is only one Fragment
     * on the stack.
     */</span>
    <span class="k">fun</span> <span class="nf">onBackPressed</span><span class="p">():</span> <span class="nc">Boolean</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">fragmentManager</span><span class="p">.</span><span class="n">backStackEntryCount</span> <span class="p">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="nf">popUp</span><span class="p">()</span>
            <span class="kd">var</span> <span class="py">currentFragment</span> <span class="p">=</span> <span class="nf">getCurrentFragment</span><span class="p">()</span>
            <span class="n">currentFragment</span><span class="o">?.</span><span class="nf">setTitle</span><span class="p">()</span>
            <span class="k">return</span> <span class="k">true</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">false</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">popUp</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">fragmentManager</span><span class="p">.</span><span class="nf">popBackStackImmediate</span><span class="p">()</span>
        <span class="n">fragmentTagStack</span><span class="p">.</span><span class="nf">pop</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">popUpAll</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">fragmentManager</span><span class="p">.</span><span class="nf">popBackStack</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="nc">FragmentManager</span><span class="p">.</span><span class="nc">POP_BACK_STACK_INCLUSIVE</span><span class="p">)</span>
        <span class="n">fragmentTagStack</span><span class="p">.</span><span class="nf">popUpAll</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">getCurrentFragment</span><span class="p">():</span> <span class="nc">IFragment</span><span class="p">?</span> <span class="p">=</span> <span class="n">fragmentManager</span><span class="p">.</span><span class="nf">findFragmentByTag</span><span class="p">(</span><span class="n">fragmentTagStack</span><span class="p">.</span><span class="n">activeTag</span><span class="p">)</span> <span class="k">as</span> <span class="nc">IFragment</span><span class="p">?</span>

    <span class="k">fun</span> <span class="nf">dispose</span><span class="p">()</span> <span class="p">=</span> <span class="nf">getCurrentFragment</span><span class="p">()</span><span class="o">?.</span><span class="nf">dispose</span><span class="p">()</span>

    <span class="k">fun</span> <span class="nf">onSaveInstanceState</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="nc">Bundle</span><span class="p">?)</span> <span class="p">{</span>
        <span class="n">state</span><span class="o">?.</span><span class="nf">putParcelable</span><span class="p">(</span><span class="nc">KEY_TAGS</span><span class="p">,</span> <span class="nc">Parcels</span><span class="p">.</span><span class="nf">wrap</span><span class="p">(</span><span class="n">fragmentTagStack</span><span class="p">))</span>
    <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">onRestoreInstanceState</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">:</span> <span class="nc">Bundle</span><span class="p">?)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">savedInstanceState</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">fragmentTagStack</span> <span class="p">=</span> <span class="nc">Parcels</span><span class="p">.</span><span class="nf">unwrap</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">.</span><span class="nf">getParcelable</span><span class="p">(</span><span class="nc">KEY_TAGS</span><span class="p">))</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">fragmentTagStack</span> <span class="p">=</span> <span class="nc">FragmentTagStack</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">FragmentTagStack.kt</code></p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
</pre><td class="rouge-code"><pre><span class="nd">@Parcel</span><span class="p">(</span><span class="nc">Parcel</span><span class="p">.</span><span class="nc">Serialization</span><span class="p">.</span><span class="nc">BEAN</span><span class="p">)</span>
<span class="kd">class</span> <span class="nc">FragmentTagStack</span> <span class="p">{</span>

    <span class="nd">@Transient</span> <span class="k">private</span> <span class="kd">var</span> <span class="py">showLogs</span><span class="p">:</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="k">false</span>

    <span class="kd">var</span> <span class="py">tags</span><span class="p">:</span> <span class="nc">MutableList</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;</span>
        <span class="k">private</span> <span class="k">set</span>

    <span class="kd">var</span> <span class="py">activeTag</span><span class="p">:</span> <span class="nc">String</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span>
        <span class="k">private</span> <span class="k">set</span>

    <span class="k">constructor</span><span class="p">(){</span>
        <span class="n">tags</span> <span class="p">=</span> <span class="nc">LinkedList</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="nd">@ParcelConstructor</span>
    <span class="k">constructor</span><span class="p">(</span><span class="n">tags</span><span class="p">:</span> <span class="nc">MutableList</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;,</span> <span class="n">activeTag</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">tags</span> <span class="p">=</span> <span class="n">tags</span>
        <span class="k">this</span><span class="p">.</span><span class="n">activeTag</span> <span class="p">=</span> <span class="n">activeTag</span>
    <span class="p">}</span>

    <span class="cm">/**
     * Enabling or disabling fragment stack logs. Logs are disabled by default.

     * @param showLogs
     */</span>
    <span class="k">fun</span> <span class="nf">setShowLogs</span><span class="p">(</span><span class="n">showLogs</span><span class="p">:</span> <span class="nc">Boolean</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">showLogs</span> <span class="p">=</span> <span class="n">showLogs</span>
    <span class="p">}</span>

    <span class="cm">/**
     * Pushing new tag to stack and setting is as [FragmentTagStack.activeTag]

     * @param tag
     */</span>
    <span class="k">fun</span> <span class="nf">push</span><span class="p">(</span><span class="n">tag</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">tags</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
        <span class="n">activeTag</span> <span class="p">=</span> <span class="n">tag</span>
        <span class="nf">logStack</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="cm">/**
     * Popping tag from the stack and setting the tag below as new [FragmentTagStack.activeTag]
     *
     *
     * Example:
     *
     *
     * Stack [3, 2, 1, 0] (3 is last added tag). [FragmentTagStack.activeTag] have value 3
     *
     *
     * Now we're popping the last added tag
     *
     *
     * Stack [2, 1, 0] [FragmentTagStack.activeTag] have value 2

     * @return Popped up value. From the example above, returned value will be 3. In case of empty stack, null will be returned.
     */</span>
    <span class="k">fun</span> <span class="nf">pop</span><span class="p">():</span> <span class="nc">String</span><span class="p">?</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">tag</span> <span class="p">=</span> <span class="nf">peek</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(!</span><span class="nc">TextUtils</span><span class="p">.</span><span class="nf">isEmpty</span><span class="p">(</span><span class="n">tag</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">tags</span><span class="p">.</span><span class="nf">removeAt</span><span class="p">(</span><span class="n">tags</span><span class="p">.</span><span class="n">size</span> <span class="p">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="n">activeTag</span> <span class="p">=</span> <span class="nf">peek</span><span class="p">()</span>
        <span class="nf">logStack</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">tag</span>
    <span class="p">}</span>

    <span class="cm">/**
     * Peeking to the top of the stack, without data modification.

     * @return Value on top of the stack. If stack is empty, returned value will be null.
     */</span>
    <span class="k">fun</span> <span class="nf">peek</span><span class="p">():</span> <span class="nc">String</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">tags</span><span class="p">.</span><span class="n">size</span> <span class="p">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">tags</span><span class="p">[</span><span class="n">tags</span><span class="p">.</span><span class="n">size</span> <span class="p">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">null</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">logStack</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">showLogs</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">val</span> <span class="py">stringBuilder</span> <span class="p">=</span> <span class="nc">StringBuilder</span><span class="p">()</span>
            <span class="n">stringBuilder</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="s">"Active tag: $activeTag\nStack:\n"</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="n">tags</span><span class="p">.</span><span class="n">size</span> <span class="p">-</span> <span class="mi">1</span> <span class="n">downTo</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">stringBuilder</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="s">"[ ${tags[i]}]\n"</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="nc">Log</span><span class="p">.</span><span class="nf">d</span><span class="p">(</span><span class="nc">TAG</span><span class="p">,</span> <span class="n">stringBuilder</span><span class="p">.</span><span class="nf">toString</span><span class="p">())</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="cm">/**
     * Clears the stack.
     */</span>
    <span class="k">fun</span> <span class="nf">popUpAll</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">tags</span><span class="p">.</span><span class="nf">clear</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">companion</span> <span class="k">object</span> <span class="p">{</span>

        <span class="nd">@Transient</span> <span class="k">private</span> <span class="kd">val</span> <span class="py">TAG</span> <span class="p">=</span> <span class="s">"FragmentTagStack"</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">IFragment.kt</code></p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>
<span class="kd">interface</span> <span class="nc">IFragment</span> <span class="p">{</span>
    <span class="k">fun</span> <span class="nf">getFragmentName</span><span class="p">():</span> <span class="nc">String</span>

    <span class="k">fun</span> <span class="nf">setTitle</span><span class="p">():</span> <span class="nc">Unit</span><span class="p">?</span>

    <span class="k">fun</span> <span class="nf">dispose</span><span class="p">()</span>
<span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">FragmentChannel.kt</code></p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>
<span class="kd">interface</span> <span class="nc">FragmentChannel</span><span class="p">{</span>
  <span class="k">fun</span> <span class="nf">setTitle</span><span class="p">(</span><span class="n">title</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">Unit</span><span class="p">?</span>
  <span class="k">fun</span> <span class="nf">showLogin</span><span class="p">()</span>
<span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">BaseFragment.kt</code></p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre>
<span class="k">abstract</span> <span class="kd">class</span> <span class="nc">BaseFragment</span> <span class="p">:</span> <span class="nc">Fragment</span><span class="p">(),</span> <span class="nc">IFragment</span><span class="p">{</span>

  <span class="kd">var</span> <span class="py">fragmentChannel</span><span class="p">:</span> <span class="nc">FragmentChannel</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span>

  <span class="k">override</span> <span class="k">fun</span> <span class="nf">onAttach</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="nc">Context</span><span class="p">){</span>
    <span class="k">super</span><span class="p">.</span><span class="nf">onAttach</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="n">context</span> <span class="k">is</span> <span class="nc">FragmentChannel</span><span class="p">){</span>
      <span class="n">fragmentChannel</span> <span class="p">=</span> <span class="n">context</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">override</span> <span class="k">fun</span> <span class="nf">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">:</span> <span class="nc">Bundle</span><span class="p">?){</span>
    <span class="k">super</span><span class="p">.</span><span class="nf">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="n">parentFragment</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="n">parentFragment</span> <span class="k">is</span> <span class="nc">FragmentChannel</span><span class="p">){</span>
      <span class="n">fragmentChannel</span> <span class="p">=</span> <span class="n">parentFragment</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">HomeFragment.kt</code></p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre>
<span class="kd">class</span> <span class="nc">HomeFragment</span> <span class="p">:</span> <span class="nc">BaseFragment</span><span class="p">()</span> <span class="p">{</span>

  <span class="k">private</span> <span class="kd">val</span> <span class="py">FRAGMENT_NAME</span> <span class="p">=</span> <span class="s">"Home"</span>

  <span class="k">companion</span> <span class="k">object</span><span class="p">{</span>
    <span class="k">fun</span> <span class="nf">newInstance</span><span class="p">()</span> <span class="p">=</span> <span class="nc">HomeFragment</span><span class="p">()</span>
  <span class="p">}</span>

  <span class="k">override</span> <span class="k">fun</span> <span class="nf">getFragmentName</span><span class="p">():</span> <span class="nc">String</span> <span class="p">=</span> <span class="nc">FRAGMENT_NAME</span>

  <span class="k">override</span> <span class="k">fun</span> <span class="nf">setTitle</span><span class="p">()</span> <span class="p">=</span> <span class="n">fragmentChannel</span><span class="o">?.</span><span class="nf">setTitle</span><span class="p">(</span><span class="nc">R</span><span class="p">.</span><span class="n">string</span><span class="p">.</span><span class="n">home</span><span class="p">)</span>

  <span class="k">fun</span> <span class="nf">onLoginButtonClick</span><span class="p">(){</span>
    <span class="n">fragmentChannel</span><span class="o">?.</span><span class="nf">showLogin</span><span class="p">()</span>
  <span class="p">}</span>

  <span class="k">override</span> <span class="k">fun</span> <span class="nf">dispose</span><span class="p">(){</span>
    <span class="nc">TODO</span><span class="p">(</span><span class="s">"Call presenter dispose method"</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">HomeActivity.kt</code></p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">HomeActivity</span> <span class="p">:</span> <span class="nc">AppCompatActivity</span><span class="p">(),</span> <span class="nc">FragmentChannel</span><span class="p">{</span>

  <span class="nd">@BindView</span><span class="p">(</span><span class="nc">R</span><span class="p">.</span><span class="n">layout</span><span class="p">.</span><span class="n">activity_home_container</span><span class="p">)</span>
  <span class="k">lateinit</span> <span class="kd">var</span> <span class="py">flContainer</span><span class="p">:</span> <span class="nc">FrameLayout</span>

  <span class="kd">val</span> <span class="py">simpleFragmentManager</span> <span class="k">by</span> <span class="nf">lazy</span> <span class="p">{</span>
    <span class="nc">SimpleFragmentManager</span><span class="p">(</span><span class="nf">getSupportFragmentManager</span><span class="p">(),</span> <span class="n">flContainer</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">override</span> <span class="k">fun</span> <span class="nf">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">:</span> <span class="nc">Bundle</span><span class="p">?){</span>
    <span class="k">super</span><span class="p">.</span><span class="nf">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">)</span>
    <span class="nf">setContentView</span><span class="p">(</span><span class="nc">R</span><span class="p">.</span><span class="n">layout</span><span class="p">.</span><span class="n">activity_home</span><span class="p">)</span>
    <span class="nc">ButterKnife</span><span class="p">.</span><span class="nf">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
    <span class="n">simpleFragmentManager</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nc">HomeFragment</span><span class="p">.</span><span class="nf">newInstance</span><span class="p">())</span>
  <span class="p">}</span>

  <span class="k">override</span> <span class="k">fun</span> <span class="nf">onSaveInstanceState</span><span class="p">(</span><span class="n">outState</span><span class="p">:</span> <span class="nc">Bundle</span><span class="p">?){</span>
    <span class="k">super</span><span class="p">.</span><span class="nf">onSaveInstanceState</span><span class="p">(</span><span class="n">outState</span><span class="p">)</span>
    <span class="n">simpleFragmentManager</span><span class="p">.</span><span class="nf">onSaveInstanceState</span><span class="p">(</span><span class="n">outState</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">override</span> <span class="k">fun</span> <span class="nf">onRestoreInstanceState</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">:</span> <span class="nc">Bundle</span><span class="p">?){</span>
    <span class="k">super</span><span class="p">.</span><span class="nf">onRestoreInstanceState</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">)</span>
    <span class="n">simpleFragmentManager</span><span class="p">.</span><span class="nf">onRestoreInstanceState</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">override</span> <span class="k">fun</span> <span class="nf">setTitle</span><span class="p">(</span><span class="n">titleId</span><span class="p">:</span> <span class="nc">Int</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">supportActionBar</span><span class="o">?.</span><span class="n">title</span> <span class="p">=</span> <span class="nf">getString</span><span class="p">(</span><span class="n">titleId</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">override</span> <span class="k">fun</span> <span class="nf">showLogin</span><span class="p">(){</span>
    <span class="n">simpleFragmentManager</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="nc">LoginFragment</span><span class="p">.</span><span class="nf">newInstance</span><span class="p">())</span>
  <span class="p">}</span>

  <span class="k">override</span> <span class="k">fun</span> <span class="nf">onBackPressed</span><span class="p">(){</span>
    <span class="k">if</span><span class="p">(!</span><span class="n">simpleFragmentManager</span><span class="p">.</span><span class="n">onBackPressed</span><span class="p">){</span>
      <span class="nf">finish</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>And last but not least on latest Google IO (2017), guys from Google found it necessary to remind everyone about the basics as well.</p><div class="videoWrapper"> <iframe width="560" height="315" src="https://www.youtube.com/embed/eUG3VWnXFtg" frameborder="0" allowfullscreen=""></iframe></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/android/'>android</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/android/" class="post-tag no-text-decoration" >android</a> <a href="/tags/fragment/" class="post-tag no-text-decoration" >fragment</a> <a href="/tags/fragmentmanager/" class="post-tag no-text-decoration" >fragmentmanager</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><!-- Post sharing snippet v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Simplified Fragment Management - Duško Bajić - Blog&url=https://dusko.dev/posts/2017/06/simplified-fragment-management/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://dusko.dev/posts/2017/06/simplified-fragment-management/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank"> <i class="fa-fw fab fa-linkedin"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Simplified Fragment Management - Duško Bajić - Blog&u=https://dusko.dev/posts/2017/06/simplified-fragment-management/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Simplified Fragment Management - Duško Bajić - Blog&url=https://dusko.dev/posts/2017/06/simplified-fragment-management/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><!-- The Pannel on right side (Desktop views) v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><h3 data-toc-skip>Recent Update</h3><ul class="post-content pl-0 pb-1 ml-1 mt-2"></ul></div><div id="access-tags"><h3 data-toc-skip>Trending Tags</h3><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/privacy/">privacy</a> <a class="post-tag" href="/tags/cloud/">cloud</a> <a class="post-tag" href="/tags/test/">test</a> <a class="post-tag" href="/tags/nextcloud/">nextcloud</a> <a class="post-tag" href="/tags/google/">google</a> <a class="post-tag" href="/tags/kotlin/">kotlin</a> <a class="post-tag" href="/tags/freelance/">freelance</a> <a class="post-tag" href="/tags/work/">work</a> <a class="post-tag" href="/tags/view/">view</a></div></div></div></div></div><div class="row"><div id="post-extend-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <!-- Navigation buttons at the bottom of the post. v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --><div class="post-navigation d-flex justify-content-between"> <a href="/posts/2016/10/remote-work-and-how-to-make-best-of-it/" class="btn btn-outline-primary"><p>Remote Work And How To Make Best Of It</p></a> <a href="/posts/2017/07/recycler-view-in-MVP/" class="btn btn-outline-primary"><p>RecyclerView with MVP</p></a></div><!-- The Disqus lazy loading. Powered by: https://osvaldas.info/lazy-loading-disqus-comments v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung MIT License --><div id="disqus" class="pt-2 pb-4"><p class="font-italic text-muted small">Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> var options = { scriptUrl: '//duskodev.disqus.com/embed.js', disqusConfig: function() { this.page.url = 'https://dusko.dev/posts/2017/06/simplified-fragment-management/'; this.page.identifier = '/posts/2017/06/simplified-fragment-management/'; } }; $.disqusLoader('#disqus', options); </script> <!-- The related posts of current post. Placed in the bottom of every single post. v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div id="related-posts" class="mt-4 mb-2 mb-sm-4 pb-2"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/2018/11/kotlin-dsl-android-automated-tests/"><div class="card-body"> <span class="timeago small"> Nov 6, 2018 <i class="unloaded">2018-11-06T13:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Kotlin DSL for Espresso and UIAutomator</h3><div class="text-muted small"><p>On Android there aren’t many choices when it comes to which library to use. Obvious choices are Espresso and UIAutomator. Although the libraries can be used for the same goal, there are crucial dif...</p></div></div></a></div><div class="card"> <a href="/posts/2018/11/android-automated-tests-with-robot-pattern/"><div class="card-body"> <span class="timeago small"> Nov 7, 2018 <i class="unloaded">2018-11-07T13:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Android automated tests with Robot pattern (in Kotlin)</h3><div class="text-muted small"><p>In previous blog post, we have discussed and shown a Kotlin DSL library we developed for the Espresso and UIAutomator, as we noticed that readability and maintainability are endangered and made a n...</p></div></div></a></div><div class="card"> <a href="/posts/2017/07/recycler-view-in-MVP/"><div class="card-body"> <span class="timeago small"> Jul 21, 2017 <i class="unloaded">2017-07-21T13:00:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>RecyclerView with MVP</h3><div class="text-muted small"><p>MVC/MVP/MVVM, we’re all talking about it. It’s modern, it’s cool, but besides that it’s useful. We’ll see if the MVP is dead, now that Google announced its own archtecture components, however, that...</p></div></div></a></div></div></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script> <!-- The Footer v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/bajicdusko">Duško Bajić</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Content rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/">Chirpy</a> theme.</p></div></div></footer></div><!-- The Search results v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/privacy/">privacy</a> <a class="post-tag" href="/tags/cloud/">cloud</a> <a class="post-tag" href="/tags/test/">test</a> <a class="post-tag" href="/tags/nextcloud/">nextcloud</a> <a class="post-tag" href="/tags/google/">google</a> <a class="post-tag" href="/tags/kotlin/">kotlin</a> <a class="post-tag" href="/tags/freelance/">freelance</a> <a class="post-tag" href="/tags/work/">work</a> <a class="post-tag" href="/tags/view/">view</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <!-- Jekyll Simple Search loader v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://dusko.dev{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
